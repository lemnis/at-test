name: NVDA

on:
  push:
    branches: [ "master" ]

jobs:
        
  nvda:
  
    name: NVDA
    
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v3
        with:
          repository: eps1lon/screen-reader-testing-library
      - name: Use node@12
        uses: actions/setup-node@v2
        with:
          node-version: 12
      - run: yarn
      - name: "examples/node/test.example.ps1"
        shell: powershell
        run: |
          # Required config
          # The path you cloned this repository to
          $REPO_PATH = "${{ github.workspace }}"
          # Optional config
          # The path where NVDA speech output is logged. Need read/write access.
          $LOG_FILE_PATH = "$REPO_PATH\nvda-node.log"
          # The path where your package manager installed the "screen-reader-testing-library" package.
          $PACKAGE_PATH = "$REPO_PATH\node_modules\screen-reader-testing-library"
          # End of configuration. Changing anything below at your own risk
          $NVDA_BIN = "$PACKAGE_PATH\bin\nvda.ps1"
          & $NVDA_BIN -logFile $LOG_FILE_PATH 
          cd output/nvda-chromium && npx codeceptjs run --config ../../codeceptjs/configs/nvda-playwright.js
          | $NVDA_BIN -quit
      - uses: actions/upload-artifact@v2
        if: ${{ always() }}
        with:
          name: nvda.log
          path: |
            nvda-node.log
      - uses: actions/upload-artifact@v2
        if: ${{ always() }}
        with:
          name: nvda.log
          path: |
            output/nvda-*
